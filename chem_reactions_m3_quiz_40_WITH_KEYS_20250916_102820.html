<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kru Pai Classroom | ปฏิกิริยาเคมี ม.3 (40 ข้อ) – พร้อมเฉลยหลังตรวจ</title>
<style>
  :root{
    --primary:#0d47a1;
    --accent:#26a69a;
    --ink:#1b1b1b;
    --bg:#f7fbff;
    --ok:#1b5e20;
    --bad:#b71c1c;
  }
  *{box-sizing:border-box}
  body{font-family:'Tahoma', system-ui, -apple-system, Segoe UI, Roboto, 'Noto Sans Thai', sans-serif; background:var(--bg); color:var(--ink); margin:0}
  header{background:linear-gradient(90deg,var(--primary),#42a5f5); color:#fff; padding:22px 16px; text-align:center}
  header h1{margin:4px 0 0; font-size:1.5rem}
  .brand{font-weight:800; letter-spacing:.4px}
  main{max-width:980px; margin:18px auto 90px; padding:0 16px}
  .card{background:#fff; border-radius:16px; box-shadow:0 8px 24px rgba(0,0,0,.08); padding:18px; margin:16px 0}
  h2{font-size:1.2rem; margin:0 0 12px}
  .q{margin:10px 0; padding:12px; border:1px solid #e7eef7; border-radius:12px; background:#fbfdff}
  .q strong{display:block; margin-bottom:6px}
  .opts{display:grid; grid-template-columns: repeat(auto-fit,minmax(220px,1fr)); gap:10px}
  label.opt, .pill{display:block; border:1px solid #dfe8f2; border-radius:10px; padding:8px 10px; cursor:pointer; transition:.2s}
  input[type="radio"]{margin-right:6px}
  .tf{display:flex; gap:12px; flex-wrap:wrap}
  .footer{position:fixed; left:0; right:0; bottom:0; background:#fffffffa; backdrop-filter:saturate(1.2) blur(4px); border-top:1px solid #e6e6e6; padding:10px 16px; display:flex; gap:10px; justify-content:center; z-index:5}
  button{padding:10px 16px; border-radius:12px; border:none; background:var(--primary); color:#fff; font-weight:700; cursor:pointer}
  button.secondary{background:#455a64}
  .scorebox{background:#e8f5e9; border:1px dashed #81c784; padding:12px; border-radius:12px; margin-top:10px}
  .ans{background:#f7f7ff; border-left:4px solid var(--accent); padding:10px; border-radius:8px; margin-top:8px; display:none}
  .hide{display:none}
  .start-wrap{display:grid; gap:12px}
  .field{display:grid; gap:6px}
  input[type="text"]{padding:10px 12px; border:1px solid #dfe3ea; border-radius:12px; font-size:1rem}
  .muted{color:#555; font-size:.95rem}
  .badge{display:inline-block; background:var(--accent); color:#fff; padding:2px 8px; border-radius:999px; font-size:.85rem; font-weight:700; margin-left:8px}
  .kru{font-weight:800; color:#fff; background:#000000aa; padding:3px 8px; border-radius:8px}
  .result-panel h2{font-size:1.35rem}
  .big{font-size:2rem; font-weight:800}
  .pass{color:var(--ok)}
  .fail{color:var(--bad)}
  .grid2{display:grid; grid-template-columns: repeat(auto-fit,minmax(240px,1fr)); gap:12px}
  .tips{background:#fff8e1; border:1px dashed #ffd54f; padding:10px; border-radius:12px}
  .correct{border-color:#a5d6a7 !important; background:#e8f5e9 !important}
  .wrong{border-color:#ef9a9a !important; background:#ffebee !important}
  .keylist{columns:2; column-gap:24px}
  @media (max-width:700px){ .keylist{columns:1} }
  .banner{background:#e3f2fd; border:1px solid #bbdefb; padding:8px 12px; border-radius:12px; margin-bottom:10px}
</style>
</head>
<body>
<header>
  <div class="brand">Kru Pai Classroom</div>
  <h1>แบบทดสอบ: ปฏิกิริยาเคมี ม.3 (40 ข้อ)</h1>
  <p class="muted">เวอร์ชันมีหน้าเริ่ม – หน้าคำถาม – หน้าสรุปคะแนน + เฉลยหลังตรวจ<span class="badge">ใหม่</span></p>
</header>

<main>
  <!-- START PAGE -->
  <section id="start" class="card">
    <h2>เริ่มเล่นเกม</h2>
    <div class="start-wrap">
      <div class="field">
        <label for="playerName">ชื่อเล่น/ชื่อผู้ทำแบบทดสอบ <span style="color:#d32f2f">*</span></label>
        <input id="playerName" type="text" placeholder="พิมพ์ชื่อของหนู เช่น 'Mind', 'Beam'">
      </div>
      <div class="field">
        <label for="playerClass">ห้อง/โรงเรียน (ถ้ามี)</label>
        <input id="playerClass" type="text" placeholder="เช่น ม.3/1 – โรงเรียนตัวอย่าง">
      </div>
      <div class="tips">เกณฑ์ผ่านทั้งชุด: <b>≥ 80%</b> ของข้อที่ตรวจอัตโนมัติ (30 ข้อแรก)</div>
      <div>
        <button onclick="startQuiz()">เริ่มทำแบบทดสอบ</button>
      </div>
    </div>
  </section>

  <!-- QUIZ PAGE -->
  <section id="quiz" class="hide">
    <div id="quizBanner" class="banner hide">โหมดดูเฉลยบนข้อ: ไฮไลต์สีเขียว = คำตอบที่ถูก, สีชมพู = ตัวเลือกที่ตอบผิด (ปิดอินพุตแล้ว)</div>

    <div class="card">
      <h2>ส่วนที่ 1: ถูก–ผิด (10 ข้อ)</h2>
      <div id="tfArea"></div>
    </div>

    <div class="card">
      <h2>ส่วนที่ 2: เลือกตอบ 4 ตัวเลือก (20 ข้อ)</h2>
      <div id="mcArea"></div>
    </div>

    <div class="card">
      <h2>ส่วนที่ 3: เติมคำตอบ/อธิบายสั้น (10 ข้อ)</h2>
      <div id="saArea" class="grid2"></div>
      <div class="scorebox" id="noteManual">ข้อ 31–40 เป็นคำตอบแบบเขียน ตรวจด้วยตนเอง โดยดูแนะแนวคำตอบหลังขึ้นผลลัพธ์</div>
    </div>
  </section>

  <!-- RESULT PAGE -->
  <section id="result" class="hide">
    <div class="card result-panel">
      <h2>สรุปผลการทำแบบทดสอบ</h2>
      <p class="muted">ผู้ทำแบบทดสอบ: <b id="rName"></b> <span class="kru">Kru Pai Classroom</span></p>
      <div class="grid2">
        <div class="card" style="margin:0">
          <div>คะแนนอัตโนมัติ (30 ข้อแรก)</div>
          <div class="big" id="rScore">0/30</div>
        </div>
        <div class="card" style="margin:0">
          <div>คิดเป็นเปอร์เซ็นต์</div>
          <div class="big" id="rPercent">0%</div>
        </div>
      </div>
      <p id="rStatus" class="big" style="margin-top:12px"></p>

      <div class="card" style="margin-top:12px">
        <h2>เฉลยแบบเต็ม (ข้อ 1–30)</h2>
        <div class="keylist">
          <ul id="keyTF"></ul>
          <ul id="keyMC"></ul>
        </div>
      </div>

      <div class="tips" style="margin-top:12px">
        <b>แนะแนวคำตอบ (ข้อ 31–40):</b>
        <ul id="guideList" style="margin:8px 0 0 18px"></ul>
      </div>

      <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:12px">
        <button onclick="window.print()" class="secondary">พิมพ์/บันทึก PDF</button>
        <button onclick="seeOnItems()">ดูเฉลยบนข้อ (ไฮไลต์)</button>
        <button onclick="restart()">กลับไปหน้าแรก</button>
      </div>
    </div>
  </section>
</main>

<div class="footer">
  <button id="btnGrade" onclick="grade()" class="hide">ตรวจและไปหน้าสรุปคะแนน</button>
  <button id="btnShowAns" onclick="toggleAnswers()" class="secondary hide">แสดง/ซ่อน เฉลยแนะแนว (ข้อ 31–40)</button>
</div>

<script>
// ---------------- Data ----------------
const TF = [
  ["ปฏิกิริยาเคมีคือการเปลี่ยนแปลงที่ทำให้เกิดสารใหม่ขึ้นมา", "T"],
  ["การเผาไหม้น้ำตาลเป็นปฏิกิริยาเคมี", "T"],
  ["การละลายน้ำตาลในน้ำเป็นปฏิกิริยาเคมี", "F"],
  ["การเกิดสนิมเหล็กเป็นปฏิกิริยาเคมี", "T"],
  ["การกลายเป็นไอของน้ำ เป็นปฏิกิริยาเคมี", "F"],
  ["การสังเคราะห์แสงเป็นปฏิกิริยาเคมี", "T"],
  ["การแข็งตัวของน้ำเป็นปฏิกิริยาเคมี", "F"],
  ["การหายใจของสิ่งมีชีวิตเป็นปฏิกิริยาเคมี", "T"],
  ["การเกิดตะกอนจากสารละลายเป็นปฏิกิริยาเคมี", "T"],
  ["การทำอาหารสุกด้วยความร้อนเป็นปฏิกิริยาเคมี", "T"],
];

const MC = [
  ["ข้อใดไม่ใช่ปฏิกิริยาเคมี",
    ["การเกิดสนิมเหล็ก","การสลายตัวของน้ำ","การละลายน้ำเกลือ","การหมักนมเป็นโยเกิร์ต"], "C"],
  ["ปฏิกิริยาการสังเคราะห์ (Synthesis reaction) คือข้อใด",
    ["2H₂ + O₂ → 2H₂O","2KClO₃ → 2KCl + 3O₂","Zn + CuSO₄ → ZnSO₄ + Cu","C₆H₁₂O₆ → 2C₂H₅OH + 2CO₂"], "A"],
  ["ปฏิกิริยาสลายตัว (Decomposition reaction) คือข้อใด",
    ["HCl + NaOH → NaCl + H₂O","CaCO₃ → CaO + CO₂","2Mg + O₂ → 2MgO","Fe + CuSO₄ → FeSO₄ + Cu"], "B"],
  ["ปฏิกิริยาเผาไหม้ของมีเทน (CH₄) ผลลัพธ์คือ",
    ["CO₂ และ H₂O","CO และ H₂","C และ H₂O","CH₃OH"], "A"],
  ["ข้อใดเป็นปฏิกิริยาการเกิดสนิมเหล็ก",
    ["Fe + O₂ + H₂O → Fe₂O₃·xH₂O","Fe + S → FeS","Fe + Cl₂ → FeCl₃","Fe + CuSO₄ → FeSO₄ + Cu"], "A"],
  ["การเปลี่ยนสีดอกไม้เมื่อสัมผัสกรด–เบส เป็นการเปลี่ยนแปลงแบบใด",
    ["กายภาพ","เคมี","ฟิสิกส์","ระเหิด"], "B"],
  ["ข้อใดจัดเป็นปฏิกิริยาออกซิเดชัน–รีดักชัน",
    ["Cu + O₂ → CuO","NaOH + HCl → NaCl + H₂O","H₂O (l) → H₂O (g)","น้ำแข็งละลาย"], "A"],
  ["สารใดเป็นตัวเร่งปฏิกิริยาในร่างกาย",
    ["ไวตามิน","เอนไซม์","โปรตีน","กลูโคส"], "B"],
  ["การหมักน้ำตาลกลูโคสจะได้ผลิตภัณฑ์ใด",
    ["CO₂ และ H₂O","CH₃OH","C₂H₅OH และ CO₂","H₂ และ O₂"], "C"],
  ["สมการใดแสดงปฏิกิริยาเคมีที่สมดุลแล้ว",
    ["H₂ + O₂ → H₂O","2H₂ + O₂ → 2H₂O","H₂ + 2O₂ → 2H₂O","4H₂ + O₂ → 2H₂O"], "B"],
  ["ข้อใดเป็นปฏิกิริยาการสลายตัวด้วยความร้อน (Thermal decomposition)",
    ["CaCO₃ → CaO + CO₂","NaCl → Na + Cl₂","H₂ + Cl₂ → 2HCl","Zn + HCl → ZnCl₂ + H₂"], "A"],
  ["ปฏิกิริยาเคมีในร่างกายที่ให้พลังงานแก่สิ่งมีชีวิตคือ",
    ["การสังเคราะห์โปรตีน","การสังเคราะห์แสง","การหายใจระดับเซลล์","การหมักนม"], "C"],
  ["ข้อใดเป็นปฏิกิริยาเคมีแบบดูดความร้อน",
    ["การสังเคราะห์แสง","การเผาไหม้ไม้","การระเบิดดินปืน","การหายใจ"], "A"],
  ["สมการใดเป็นปฏิกิริยาการแทนที่เดี่ยว (Single displacement)",
    ["Zn + 2HCl → ZnCl₂ + H₂","HCl + NaOH → NaCl + H₂O","2H₂ + O₂ → 2H₂O","CaCO₃ → CaO + CO₂"], "A"],
  ["การเกิดฟองแก๊สเมื่อเติมกรดลงในโลหะ เป็นปฏิกิริยาใด",
    ["การสังเคราะห์","การสลายตัว","การแทนที่","การเกิดตะกอน"], "C"],
  ["ข้อใดเป็นตัวอย่างของการเปลี่ยนแปลงทางกายภาพ",
    ["น้ำแข็งละลาย","เหล็กเป็นสนิม","น้ำตาลไหม้","นมบูด"], "A"],
  ["ในการทดลองเผาไหม้ธาตุแมกนีเซียม สังเกตเห็นปรากฏการณ์ใด",
    ["เกิดเปลวไฟสีเขียว","เกิดแสงจ้าและผงสีขาว","เกิดแก๊สคาร์บอนไดออกไซด์","ไม่มีการเปลี่ยนแปลง"], "B"],
  ["ตัวเร่งปฏิกิริยา (Catalyst) มีคุณสมบัติอย่างไร",
    ["ทำให้ปฏิกิริยาเร็วขึ้นและถูกใช้หมดไป","ทำให้ปฏิกิริยาเร็วขึ้นและไม่ถูกใช้หมดไป","ทำให้ปฏิกิริยาช้าลง","เป็นสารตั้งต้นของปฏิกิริยา"], "B"],
  ["การเปลี่ยนสีของใบไม้ในฤดูใบไม้ร่วง เกิดจากปฏิกิริยาเคมีในกลุ่มใด",
    ["สลายตัว","ออกซิเดชัน","เผาไหม้","ดูดความร้อน"], "B"],
  ["การทดสอบก๊าซด้วยไม้ติดไฟที่ดับแล้ว จะใช้พิสูจน์ก๊าซใด",
    ["CO₂","H₂","O₂","N₂"], "C"]
];

const SA = [
  ["เขียนสมการเคมีการสลายตัวของไฮโดรเจนเปอร์ออกไซด์ (H₂O₂)", "2H₂O₂ → 2H₂O + O₂"],
  ["อธิบายความแตกต่างระหว่างการเปลี่ยนแปลงทางกายภาพและทางเคมี (สั้น ๆ)", "กายภาพ: ไม่มีสารใหม่ สมบัติเดิมกลับได้; เคมี: เกิดสารใหม่ สมบัติเปลี่ยน กลับคืนเดิมยาก"],
  ["ยกตัวอย่างปฏิกิริยาเคมีในชีวิตประจำวัน 3 อย่าง", "ทำอาหารสุก, เหล็กเป็นสนิม, การหายใจ/หมัก"],
  ["ทำไมการหายใจจึงจัดเป็นปฏิกิริยาเคมี", "เปลี่ยนกลูโคส + O₂ เป็น CO₂ + H₂O พร้อมให้พลังงาน"],
  ["อธิบายการเกิดสนิมเหล็ก", "เหล็กทำปฏิกิริยากับ O₂ และ H₂O ได้ Fe₂O₃·xH₂O"],
  ["เขียนสมการปฏิกิริยาระหว่าง Zn และ HCl", "Zn + 2HCl → ZnCl₂ + H₂"],
  ["ทำไมปฏิกิริยาเคมีบางอย่างต้องใช้ตัวเร่งปฏิกิริยา", "เพื่อลดพลังงานก่อกัมมันต์ ทำให้เกิดปฏิกิริยาเร็วขึ้น โดยตัวเร่งไม่ถูกใช้หมด"],
  ["เมื่อเติม BaCl₂ ลงใน Na₂SO₄ จะเกิดอะไรขึ้น (เขียนสมการ)", "BaCl₂ + Na₂SO₄ → BaSO₄↓ + 2NaCl (เกิดตะกอน BaSO₄)"],
  ["การสังเคราะห์แสงจัดเป็นปฏิกิริยาแบบใด และเพราะเหตุใด", "เป็นปฏิกิริยาดูดความร้อน/สังเคราะห์ ใช้พลังงานแสงสร้างกลูโคสและ O₂"],
  ["เขียนสมการเคมีของการเผาไหม้ก๊าซมีเทน (CH₄)", "CH₄ + 2O₂ → CO₂ + 2H₂O"],
];

// ---------------- Helpers ----------------
function el(tag, attrs={}, html=""){
  const d = document.createElement(tag);
  for(const k in attrs) d.setAttribute(k, attrs[k]);
  d.innerHTML = html;
  return d;
}

// ---------------- Renderers ----------------
function renderQuiz(){
  // TF
  const tfArea = document.getElementById('tfArea');
  TF.forEach((t,i)=>{
    const idx = i+1;
    const q = el('div', {class:'q'});
    q.innerHTML = `
      <strong>${idx}. ${t[0]}</strong>
      <div class="tf">
        <label class="pill"><input type="radio" name="tf${idx}" value="T">ถูก</label>
        <label class="pill"><input type="radio" name="tf${idx}" value="F">ผิด</label>
      </div>`;
    tfArea.appendChild(q);
  });

  // MC 11-30
  const letters = ['A','B','C','D'];
  const mcArea = document.getElementById('mcArea');
  MC.forEach((m, i)=>{
    const num = 11+i;
    const q = el('div', {class:'q'});
    const opts = m[1].map((c,j)=>`<label class="opt"><input type="radio" name="mc${num}" value="${letters[j]}">${letters[j]}. ${c}</label>`).join('');
    q.innerHTML = `<strong>${num}. ${m[0]}</strong><div class="opts">${opts}</div>`;
    mcArea.appendChild(q);
  });

  // SA 31-40
  const saArea = document.getElementById('saArea');
  SA.forEach((s, i)=>{
    const num = 31+i;
    const wrap = el('div', {class:'q'});
    wrap.innerHTML = `
      <strong>${num}. ${s[0]}</strong>
      <textarea style="width:100%;min-height:80px;border-radius:10px;border:1px solid #ddd;padding:8px" placeholder="พิมพ์คำตอบที่นี่..."></textarea>
      <div class="ans"><b>แนะแนวคำตอบ:</b> ${s[1]}</div>`;
    saArea.appendChild(wrap);
  });
}

// ---------------- Navigation ----------------
function startQuiz(){
  const name = document.getElementById('playerName').value.trim();
  if(!name){ alert('กรอกชื่อก่อนเริ่มทำแบบทดสอบนะจ๊ะ'); return; }
  document.getElementById('start').classList.add('hide');
  document.getElementById('quiz').classList.remove('hide');
  document.getElementById('btnGrade').classList.remove('hide');
  document.getElementById('btnShowAns').classList.remove('hide');
  renderQuiz();
  window.scrollTo({top:0,behavior:'smooth'});
}

// ---------------- Grading + Keys ----------------
let graded = false;
function grade(){
  const tfKey = TF.map(x=>x[1]);
  const mcKey = MC.map(x=>x[2]);
  let score=0;

  for(let i=1;i<=10;i++){ 
    const ch = document.querySelector('input[name=tf'+i+']:checked');
    if(ch && ch.value.toUpperCase()===tfKey[i-1].toUpperCase()) score++;
  }
  for(let i=11;i<=30;i++){ 
    const ch = document.querySelector('input[name=mc'+i+']:checked');
    const ans = mcKey[i-11];
    if(ch && ch.value===ans) score++;
  }

  const percent = Math.round(score*100/30);
  const pass = percent>=80;
  graded = true;

  // fill result page
  document.getElementById('rName').textContent = document.getElementById('playerName').value.trim();
  document.getElementById('rScore').textContent = score+"/30";
  document.getElementById('rPercent').textContent = percent+"%";
  const st = document.getElementById('rStatus');
  st.textContent = pass ? "ผ่านเกณฑ์ ✅" : "ยังไม่ผ่าน ⛳ ลองใหม่อีกครั้ง!";
  st.className = "big " + (pass? "pass":"fail");

  // Answer keys (TF & MC)
  const keyTF = document.getElementById('keyTF');
  keyTF.innerHTML = "<h3>ส่วนที่ 1: ถูก–ผิด</h3>";
  TF.forEach((t,i)=>{
    const li = el('li', {}, (i+1)+". "+(t[1]==='T'?'ถูก':'ผิด'));
    keyTF.appendChild(li);
  });
  const keyMC = document.getElementById('keyMC');
  keyMC.innerHTML = "<h3>ส่วนที่ 2: เลือกตอบ</h3>";
  MC.forEach((m,i)=>{
    const num = 11+i;
    const li = el('li', {}, num+". คำตอบที่ถูก: "+m[2]);
    keyMC.appendChild(li);
  });

  // guides SA
  const ul = document.getElementById('guideList');
  ul.innerHTML = "";
  SA.forEach((s,i)=>{
    const li = el('li', {}, (31+i)+". "+s[1]);
    ul.appendChild(li);
  });

  // show results
  document.getElementById('quiz').classList.add('hide');
  document.getElementById('btnGrade').classList.add('hide');
  document.getElementById('btnShowAns').classList.add('hide');
  document.getElementById('result').classList.remove('hide');
  window.scrollTo({top:0,behavior:'smooth'});
}

// ---------------- Review on items (highlight) ----------------
function seeOnItems(){
  // highlight correct/incorrect on quiz items and disable inputs
  const tfKey = TF.map(x=>x[1]);
  const mcKey = MC.map(x=>x[2]);

  // TF
  for(let i=1;i<=10;i++){
    const correct = tfKey[i-1];
    const labels = document.querySelectorAll('input[name=tf'+i+']');
    labels.forEach(inp=>{
      const label = inp.closest('label');
      if(inp.value.toUpperCase()===correct.toUpperCase()){
        label.classList.add('correct');
      }
      if(inp.checked && inp.value.toUpperCase()!==correct.toUpperCase()){
        label.classList.add('wrong');
      }
      inp.disabled = true;
    });
  }
  // MC
  for(let i=11;i<=30;i++){
    const correct = mcKey[i-11];
    const labels = document.querySelectorAll('input[name=mc'+i+']');
    labels.forEach(inp=>{
      const label = inp.closest('label');
      if(inp.value===correct){
        label.classList.add('correct');
      }
      if(inp.checked && inp.value!==correct){
        label.classList.add('wrong');
      }
      inp.disabled = true;
    });
  }

  // show SA hints on quiz
  document.querySelectorAll('#saArea .ans').forEach(el=>{ el.style.display='block'; });

  // switch view
  document.getElementById('result').classList.add('hide');
  document.getElementById('quiz').classList.remove('hide');
  document.getElementById('quizBanner').classList.remove('hide');
  window.scrollTo({top:0,behavior:'smooth'});
}

function restart(){ location.reload(); }
function toggleAnswers(){
  document.querySelectorAll('.ans').forEach(el=>{
    el.style.display = (el.style.display==='none' || el.style.display==='') ? 'block':'none';
  });
}
</script>
</body>
</html>
